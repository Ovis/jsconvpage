<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SQL Insert文を表形式表示</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; vertical-align: top; }
  </style>
</head>
<body>

<h2>INSERT文をカラムと値に分解して表形式表示</h2>
<textarea id="sqlInput" rows="30" placeholder="INSERT文を貼り付けてください"></textarea>
<br>
<button onclick="parseInsert()">解析</button>

<div id="result"></div>

<script>
function parseInsert() {
  const inputRaw = document.getElementById("sqlInput").value;
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  // GO や末尾の不要な空白・改行削除
  const input = inputRaw.replace(/\bGO\b/gi, "").trim();

  // カラム部分抽出
  const columnMatch = input.match(/\([\s\S]*?\)\s*VALUES/i);
  const valuesMatch = input.match(/VALUES\s*\(([\s\S]+?)\)\s*;?$/i);

  if (!columnMatch || !valuesMatch) {
    resultDiv.innerHTML = "<p style='color:red;'>INSERT文の解析に失敗しました。</p>";
    return;
  }

  const rawColumns = columnMatch[0]
    .replace(/^\s*\(/, "")
    .replace(/\)\s*VALUES/i, "")
    .replace(/\r?\n/g, "")
    .trim();

  const columns = rawColumns
    .split(/,(?![^\[]*\])/)
    .map(c => c.trim().replace(/^\[|\]$/g, ""));

  const valuesRaw = valuesMatch[1].trim();

  const values = [];
  let current = '';
  let inString = false;
  let parenDepth = 0;

  for (let i = 0; i < valuesRaw.length; i++) {
    const char = valuesRaw[i];
    if (char === "'" && valuesRaw[i - 1] !== "\\") {
      inString = !inString;
    }
    if (!inString) {
      if (char === '(') parenDepth++;
      if (char === ')') parenDepth--;
      if (char === ',' && parenDepth === 0) {
        values.push(current.trim());
        current = '';
        continue;
      }
    }
    current += char;
  }

  if (current.trim() !== '') {
    values.push(current.trim());
  }

  // 結果チェック
  if (columns.length !== values.length) {
    resultDiv.innerHTML = `<p style='color:red;'>カラム数 (${columns.length}) と 値の数 (${values.length}) が一致しません。</p>`;
    return;
  }

  // テーブル描画
  let html = "<table><thead><tr><th>カラム名</th><th>値</th></tr></thead><tbody>";
  for (let i = 0; i < columns.length; i++) {
    html += `<tr><td>${columns[i]}</td><td>${values[i]}</td></tr>`;
  }
  html += "</tbody></table>";

  resultDiv.innerHTML = html;
}
</script>

</body>
</html>
